<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cbonds: –ü–æ–ª—ë—Ç –∫ —Ü–µ–Ω—Ç—Ä—É –ì–∞–ª–∞–∫—Ç–∏–∫–∏</title>

  <style>
    :root{
      --bg0:#04060c;
      --bg1:#07122a;
      --panel:#0a1326cc;
      --stroke:#1e2f55;
      --text:#dbe7ff;
      --muted:#9fb3dd;
      --accent:#4cc9f0;
      --good:#7CFF7C;
      --bad:#ff4d6d;
      --warn:#ffd166;

      --glass: rgba(3,7,16,.40);
      --glass2: rgba(10,19,38,.78);

      --mapBorder: rgba(30,47,85,.75);
      --mapGlow: rgba(76,201,240,.18);
      --mapGlow2: rgba(124,255,124,.14);

      --beaconIdle: rgba(219,231,255,.55);
      --beaconActive: rgba(76,201,240,.95);
      --beaconGood: rgba(124,255,124,.95);
      --beaconWarn: rgba(255,209,102,.95);
      --beaconBad: rgba(255,77,109,.95);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      color:var(--text);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(76,201,240,.22), transparent 60%),
        radial-gradient(700px 400px at 80% 30%, rgba(124,255,124,.14), transparent 60%),
        radial-gradient(900px 700px at 50% 120%, rgba(255,77,109,.10), transparent 65%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      overflow:hidden;
    }

    /* subtle starfield */
    body::before{
      content:"";
      position:fixed; inset:0;
      background-image:
        radial-gradient(1px 1px at 12% 22%, rgba(255,255,255,.6) 50%, transparent 51%),
        radial-gradient(1px 1px at 67% 18%, rgba(255,255,255,.5) 50%, transparent 51%),
        radial-gradient(1px 1px at 32% 78%, rgba(255,255,255,.45) 50%, transparent 51%),
        radial-gradient(1px 1px at 85% 63%, rgba(255,255,255,.5) 50%, transparent 51%),
        radial-gradient(1px 1px at 45% 40%, rgba(255,255,255,.35) 50%, transparent 51%),
        radial-gradient(1px 1px at 8% 88%, rgba(255,255,255,.3) 50%, transparent 51%),
        radial-gradient(1px 1px at 92% 90%, rgba(255,255,255,.35) 50%, transparent 51%);
      opacity:.8;
      pointer-events:none;
      filter: drop-shadow(0 0 6px rgba(255,255,255,.12));
      animation: drift 18s linear infinite;
    }
    @keyframes drift{
      from{transform:translateY(0)}
      to{transform:translateY(18px)}
    }

    .wrap{
      width:min(1120px, 100%);
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(10,19,38,.86), rgba(8,14,28,.86));
      box-shadow: 0 20px 60px rgba(0,0,0,.55), 0 0 80px rgba(76,201,240,.10);
      border-radius:16px;
      overflow:hidden;
      position:relative;
    }

    .top{
      padding:18px 18px 10px 18px;
      border-bottom:1px solid rgba(30,47,85,.8);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .title{
      display:flex; flex-direction:column; gap:6px;
      max-width: 620px;
    }
    .title h1{
      margin:0;
      font-size:18px;
      letter-spacing:.4px;
      color:var(--accent);
    }
    .subtitle{
      font-size:12px;
      color:var(--muted);
      line-height: 1.45;
    }

    .stats{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      justify-content:flex-end;
      min-width: 300px;
    }
    .stat{
      width: 260px;
      padding:10px 10px 8px 10px;
      border:1px solid rgba(30,47,85,.75);
      background: rgba(3,7,16,.35);
      border-radius:12px;
    }
    .stat .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      color:var(--muted);
      margin-bottom:8px;
    }
    .bar{
      height:10px;
      background:#0b1733;
      border:1px solid rgba(30,47,85,.65);
      border-radius:999px;
      overflow:hidden;
    }
    .fill{
      height:100%;
      width:0%;
      transition:width .35s ease;
    }
    .fill.progress{ background: linear-gradient(90deg, rgba(124,255,124,.85), rgba(76,201,240,.75)); }
    .fill.stress{ background: linear-gradient(90deg, rgba(255,77,109,.85), rgba(255,209,102,.65)); }

    .main{
      padding:18px;
      display:grid;
      grid-template-columns: 1.35fr 1fr;
      gap:14px;
      align-items:start;
    }

    .card{
      border:1px solid rgba(30,47,85,.75);
      background: rgba(3,7,16,.35);
      border-radius:14px;
      padding:16px;
      position:relative;
      overflow:hidden;
    }
    .card::after{
      content:"";
      position:absolute;
      right:-80px; top:-80px;
      width:200px; height:200px;
      background: radial-gradient(circle, rgba(76,201,240,.18), transparent 60%);
      transform: rotate(20deg);
      pointer-events:none;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:11px;
      color:var(--muted);
      letter-spacing:.3px;
      text-transform:uppercase;
      margin-bottom:10px;
    }
    .tag .dot{
      width:8px; height:8px; border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(76,201,240,.6);
    }
    .tag.warn .dot{ background: var(--warn); box-shadow: 0 0 12px rgba(255,209,102,.55); }
    .tag.bad .dot{ background: var(--bad); box-shadow: 0 0 12px rgba(255,77,109,.55); }
    .tag.good .dot{ background: var(--good); box-shadow: 0 0 12px rgba(124,255,124,.55); }

    .scene-title{
      margin:0 0 10px 0;
      font-size:16px;
      color:var(--text);
      line-height: 1.25;
    }
    .scene-text{
      margin:0;
      color:var(--text);
      line-height:1.6;
      font-size:13.5px;
      opacity:.95;
      white-space:pre-wrap;
    }

    /* Fallback list (mobile/accessibility) */
    .choices{
      display:grid;
      gap:10px;
      margin-top:12px;
    }
    button.choice{
      width:100%;
      text-align:left;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(30,47,85,.8);
      background: rgba(12,24,52,.7);
      color:var(--text);
      cursor:pointer;
      transition: transform .08s ease, background .18s ease, border-color .18s ease;
      font: inherit;
    }
    button.choice:hover{
      background: rgba(18,40,90,.75);
      border-color: rgba(76,201,240,.65);
    }
    button.choice:active{ transform: translateY(1px); }

    /* Map */
    .mapCard{
      padding:12px;
    }
    .mapWrap{
      border: 1px solid var(--mapBorder);
      border-radius: 14px;
      overflow:hidden;
      background: var(--glass);
      position:relative;
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
      aspect-ratio: 16 / 9;
      min-height: 360px;
    }

    /* Embedded images as data URIs (single-file deploy) */
    .mapWrap::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(900px 520px at 20% 20%, var(--mapGlow), transparent 62%),
        radial-gradient(860px 500px at 70% 35%, var(--mapGlow2), transparent 62%),
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAmAAAAGQCAYAAABKk/2oAAAACXBIWXMAAAsSAAALEgHS3X78AAAgAElEQVR4nO3deXxU9f3/8de9kz5J0mQyJm2wC0oCkKQkKUEFhOq1oVZrV9tqVfVqf2v1qv+q1p7rXx6m0m0o3m0o7a0oZySxJgk2Qk7mTzv7z8cJw2wzJkzM5n3n3n7+9wz6xwz7nO+8+7wzjzj8uI0AAABg6r3mCwAAAHB2xv0AAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAABw4wEAAAByX8CwAAGq1z2wAAAABJRU5ErkJggg==");
      background-size: cover;
      background-position:center;
      filter: saturate(1.05) contrast(1.02);
      opacity:.95;
      transform: scale(1.02);
    }

    .mapWrap::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(1400px 700px at 30% 120%, rgba(0,0,0,.35), transparent 55%),
        radial-gradient(800px 420px at 70% 10%, rgba(0,0,0,.25), transparent 50%);
      pointer-events:none;
      mix-blend-mode: multiply;
    }

    /* Cbonds logo watermark */
    .logoWatermark{
      position:absolute;
      inset:auto 14px 14px auto;
      width: 210px;
      height: 64px;
      opacity: .18;
      filter: drop-shadow(0 8px 18px rgba(0,0,0,.55));
      pointer-events:none;
      background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAh8AAABPCAYAAABv6j4ZAAAACXBIWXMAAAsSAAALEgHS3X78AAABO0lEQVR4nO3cMQEAAAwCoNm/9HIYQ4I2sGQJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8C4e2wABe1xq7wAAAABJRU5ErkJggg==");
      background-size: contain;
      background-repeat:no-repeat;
      background-position:right bottom;
    }

    .mapSvg{
      position:absolute; inset:0;
      width:100%;
      height:100%;
    }

    .mapHud{
      position:absolute;
      left:12px; top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      padding:8px 10px;
      border:1px solid rgba(30,47,85,.75);
      background: rgba(3,7,16,.45);
      border-radius: 12px;
      backdrop-filter: blur(6px);
      font-size: 12px;
      color: var(--muted);
    }
    .hudItem{
      display:flex; gap:8px; align-items:center;
      padding-right:10px;
      border-right:1px solid rgba(30,47,85,.55);
    }
    .hudItem:last-child{ border-right:none; padding-right:0; }
    .kbd{
      padding:2px 6px;
      border:1px solid rgba(30,47,85,.75);
      border-bottom-color: rgba(30,47,85,.95);
      border-radius:8px;
      background: rgba(12,24,52,.55);
      color: var(--text);
      font-size: 11px;
    }

    .legend{
      position:absolute;
      left:12px; bottom:12px;
      padding:10px;
      border:1px solid rgba(30,47,85,.75);
      background: rgba(3,7,16,.45);
      border-radius: 12px;
      backdrop-filter: blur(6px);
      font-size: 11px;
      color: var(--muted);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      max-width: calc(100% - 24px);
    }
    .legItem{ display:flex; align-items:center; gap:8px; }
    .swatch{
      width:10px; height:10px;
      border-radius: 999px;
      box-shadow: 0 0 12px rgba(255,255,255,.15);
      border:1px solid rgba(0,0,0,.35);
    }
    .swatch.a{ background: var(--beaconActive); box-shadow: 0 0 14px rgba(76,201,240,.35); }
    .swatch.g{ background: var(--beaconGood); box-shadow: 0 0 14px rgba(124,255,124,.30); }
    .swatch.w{ background: var(--beaconWarn); box-shadow: 0 0 14px rgba(255,209,102,.25); }
    .swatch.i{ background: var(--beaconIdle); opacity:.8; }

    .footer{
      padding:14px 18px;
      border-top:1px solid rgba(30,47,85,.8);
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .hint{ opacity:.9 }
    .pill{
      border:1px solid rgba(30,47,85,.75);
      background: rgba(3,7,16,.35);
      padding:6px 10px;
      border-radius:999px;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .pill b{ color:var(--text); font-weight:700 }

    /* Responsive */
    @media (max-width: 980px){
      .main{
        grid-template-columns: 1fr;
      }
      .mapWrap{
        min-height: 320px;
      }
    }

    /* SVG interaction polish */
    .clickable{ cursor:pointer; }
    .noSelect{ user-select:none; -webkit-user-select:none; }
  </style>
</head>

<body>
  <div class="wrap" role="application" aria-label="Cbonds: –ü–æ–ª—ë—Ç –∫ —Ü–µ–Ω—Ç—Ä—É –ì–∞–ª–∞–∫—Ç–∏–∫–∏">
    <div class="top">
      <div class="title">
        <h1>Cbonds: –ü–æ–ª—ë—Ç –∫ —Ü–µ–Ω—Ç—Ä—É –ì–∞–ª–∞–∫—Ç–∏–∫–∏</h1>
        <div class="subtitle">FTL-–≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ: –≤—ã–±–∏—Ä–∞–π —Å–µ–∫—Ç–æ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ. –ö–∞–∂–¥—ã–π –≤—ã–±–æ—Ä –º–µ–Ω—è–µ—Ç —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é –∏ –¥–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —ç–∫–∏–ø–∞–∂.</div>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="row"><span>üöÄ –ü—Ä–æ–≥—Ä–µ—Å—Å</span><span id="progressNum">0 / 100</span></div>
          <div class="bar"><div class="fill progress" id="progressFill"></div></div>
        </div>
        <div class="stat">
          <div class="row"><span>‚ö†Ô∏è –°—Ç—Ä–µ—Å—Å</span><span id="stressNum">20 / 100</span></div>
          <div class="bar"><div class="fill stress" id="stressFill"></div></div>
        </div>
      </div>
    </div>

    <div class="main">
      <!-- MAP -->
      <div class="card mapCard">
        <div class="tag" id="tag"><span class="dot"></span><span id="tagText">–°–µ–∫—Ç–æ—Ä: –û—Ä–±–∏—Ç–∞ –ö–ª–∏–µ–Ω—Ç–æ–≤</span></div>

        <div class="mapWrap" aria-label="–ö–∞—Ä—Ç–∞ —Å–µ–∫—Ç–æ—Ä–æ–≤" role="group">
          <svg class="mapSvg" id="mapSvg" viewBox="0 0 1000 560" preserveAspectRatio="xMidYMid slice" aria-hidden="false">
            <defs>
              <filter id="glowA" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="3" result="blur"/>
                <feMerge>
                  <feMergeNode in="blur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
              <filter id="glowB" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="6" result="blur"/>
                <feMerge>
                  <feMergeNode in="blur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
              <linearGradient id="routeGrad" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="rgba(219,231,255,.25)"/>
                <stop offset="65%" stop-color="rgba(76,201,240,.35)"/>
                <stop offset="100%" stop-color="rgba(124,255,124,.45)"/>
              </linearGradient>
            </defs>

            <!-- subtle route line -->
            <path id="routePath"
              d="M 70 310 C 200 240, 300 380, 420 310 S 650 230, 760 300 S 900 330, 960 280"
              fill="none"
              stroke="url(#routeGrad)"
              stroke-width="3"
              stroke-linecap="round"
              opacity="0.75"
            />

            <!-- static sector nodes layer -->
            <g id="staticNodes" opacity="0.85"></g>

            <!-- ship marker along progress -->
            <g id="shipLayer"></g>

            <!-- interactive beacons for current choices -->
            <g id="choicesLayer"></g>

            <!-- finish beacon (progress 100, far right) -->
            <g id="finishLayer"></g>
          </svg>

          <div class="mapHud">
            <div class="hudItem"><span>üõ∞Ô∏è</span><span>–ö–ª–∏–∫–∞–π—Ç–µ –ø–æ –º–∞—è–∫–∞–º</span></div>
            <div class="hudItem"><span class="kbd">Tab</span><span> ‚Äî —Ñ–æ–∫—É—Å</span></div>
            <div class="hudItem"><span class="kbd">Enter</span><span> ‚Äî –≤—ã–±—Ä–∞—Ç—å</span></div>
          </div>

          <div class="legend">
            <div class="legItem"><span class="swatch a"></span><span>–¥–æ—Å—Ç—É–ø–Ω—ã–π —Ö–æ–¥</span></div>
            <div class="legItem"><span class="swatch i"></span><span>—Å–µ–∫—Ç–æ—Ä</span></div>
            <div class="legItem"><span class="swatch g"></span><span>—Ñ–∏–Ω–∏—à (100)</span></div>
          </div>

          <div class="logoWatermark" aria-hidden="true"></div>
        </div>

        <!-- mobile fallback buttons -->
        <div class="choices" id="choices" aria-label="–í–∞—Ä–∏–∞–Ω—Ç—ã (fallback)"></div>
      </div>

      <!-- STORY -->
      <div class="card">
        <h2 class="scene-title" id="sceneTitle">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞‚Ä¶</h2>
        <p class="scene-text" id="sceneText"></p>

        <div class="choices" id="choicesRight" aria-label="–í–∞—Ä–∏–∞–Ω—Ç—ã (—Å–ø–∏—Å–∫–æ–º)"></div>
      </div>
    </div>

    <div class="footer">
      <div class="hint">–§–∏–Ω–∞–ª: –ø—Ä–æ–≥—Ä–µ—Å—Å <b>100%</b> (–ø–æ–±–µ–¥–∞) –∏–ª–∏ —Å—Ç—Ä–µ—Å—Å <b>100%</b> (–ø–æ—Ä–∞–∂–µ–Ω–∏–µ). –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã ‚Äî —Ñ–∞—Ç–∞–ª—å–Ω—ã.</div>
      <div class="pill">–¶–∏–∫–ª: <b id="cycle">1</b> <span>¬∑</span> –£–∑–µ–ª: <b id="nodeId">‚Äî</b></div>
    </div>
  </div>

<script>
(function(){
  // ---------------------------
  // State (–ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞)
  // ---------------------------
  const state = {
    progress: 0,
    stress: 20,
    cycle: 1,
    flags: {
      asteroid_possible: false,
      fuzzy_requirements: false,
      audit_risk: false
    },
    stepsSinceRandom: 0,
    pendingReturn: null,
    currentNode: "E1",
    visited: new Set(["E1"])
  };

  // ---------------------------
  // Helpers
  // ---------------------------
  const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
  const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
  const chance = (p) => Math.random() < p;

  const ui = {
    tag: document.getElementById("tag"),
    tagText: document.getElementById("tagText"),
    sceneTitle: document.getElementById("sceneTitle"),
    sceneText: document.getElementById("sceneText"),
    // fallback choices (left bottom)
    choices: document.getElementById("choices"),
    // right panel choices
    choicesRight: document.getElementById("choicesRight"),

    progressFill: document.getElementById("progressFill"),
    stressFill: document.getElementById("stressFill"),
    progressNum: document.getElementById("progressNum"),
    stressNum: document.getElementById("stressNum"),
    cycle: document.getElementById("cycle"),
    nodeId: document.getElementById("nodeId"),

    mapSvg: document.getElementById("mapSvg"),
    staticNodes: document.getElementById("staticNodes"),
    shipLayer: document.getElementById("shipLayer"),
    choicesLayer: document.getElementById("choicesLayer"),
    finishLayer: document.getElementById("finishLayer"),
    routePath: document.getElementById("routePath"),
  };

  function setTag(kind, text){
    ui.tag.className = "tag" + (kind ? (" " + kind) : "");
    ui.tagText.textContent = text;
  }

  function applyDelta(dp, ds){
    state.progress = clamp(state.progress + (dp || 0), 0, 100);
    state.stress   = clamp(state.stress + (ds || 0), 0, 100);
    updateBars();
  }

  function updateBars(){
    ui.progressFill.style.width = state.progress + "%";
    ui.stressFill.style.width = state.stress + "%";
    ui.progressNum.textContent = `${state.progress} / 100`;
    ui.stressNum.textContent = `${state.stress} / 100`;
    ui.cycle.textContent = String(state.cycle);
    ui.nodeId.textContent = String(state.currentNode);
  }

  function endIfNeeded(){
    if (state.stress >= 100) {
      renderEnd(false, "–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º.\n–°—Ç—Ä–µ—Å—Å —ç–∫–∏–ø–∞–∂–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π.\n–ö–æ—Ä–∞–±–ª—å —É—Ö–æ–¥–∏—Ç –≤ –¥—Ä–µ–π—Ñ.");
      return true;
    }
    if (state.progress >= 100) {
      renderEnd(true, "–ö–æ—Ä–∞–±–ª—å –¥–æ—Å—Ç–∏–≥–∞–µ—Ç —Ü–µ–Ω—Ç—Ä–∞ –ì–∞–ª–∞–∫—Ç–∏–∫–∏.\n–ú–∏—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.\n–§–ª–æ—Ç –ø—Ä–∏–∑–Ω–∞—ë—Ç —Ç–µ–±—è –ö–∞–ø–∏—Ç–∞–Ω–æ–º –º–∞—Ä—à—Ä—É—Ç–∞.");
      return true;
    }
    return false;
  }

  function renderEnd(isWin, text){
    state.currentNode = isWin ? "WIN" : "LOSE";
    state.visited.add(state.currentNode);
    updateBars();

    setTag(isWin ? "good" : "bad", isWin ? "–§–∏–Ω–∞–ª: –¶–µ–Ω—Ç—Ä –ì–∞–ª–∞–∫—Ç–∏–∫–∏" : "–§–∏–Ω–∞–ª: –î—Ä–µ–π—Ñ");
    ui.sceneTitle.textContent = isWin ? "–ü—Ä—ã–∂–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω" : "–°–∏—Å—Ç–µ–º—ã –æ—Ç–∫–∞–∑–∞–ª–∏";
    ui.sceneText.textContent = text;

    // choices -> restart
    const restartChoice = {
      label: "–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ü–∏–∫–ª",
